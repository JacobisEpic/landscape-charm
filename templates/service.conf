{% set postgres = db[0] %}
{% set rabbitmq = amqp[0] %}
[global]
# Syslog address is either a socket path or server:port string.
syslog-address = /dev/log
deployment-mode = {{ hosted[0]["deployment-mode"] }}

[stores]
host = {{ postgres["host"] }}:{{ postgres["port"] }}
user = landscape
password = {{ leader["database-password"] }}
main = landscape-main
account-1 = landscape-account-1
resource-1 = landscape-resource-1
package = landscape-package
session = landscape-session
session-autocommit = landscape-session?isolation=autocommit
knowledge = landscape-knowledge

[broker]
port = 5672
host = {{ rabbitmq["hostname"] }}
user = landscape
password = {{ rabbitmq["password"] }}
vhost = landscape

[schema]
threads = 1
stores = main account-1 resource-1 package session knowledge
store_user = {{ postgres["user"] }}
store_password = {{ postgres["password"] }}

[landscape]
base-port = 8080
threads = 8
stores = main account-1 resource-1 package session session-autocommit knowledge
mailer = queue
mailer-path = /var/lib/landscape/landscape-mail-queue
reprepro-binary = /opt/canonical/landscape/scripts/reprepro-wrapper.sh
repository-path = /var/lib/landscape/landscape-repository
secret-token = {{ leader["secret-token"] }}
{% if config["openid-provider-url"] %}
openid-provider-url = {{ config["openid-provider-url"] }}
{% endif %}
{% if config["openid-logout-url"] %}
openid-logout-url = {{ config["openid-logout-url"] }}
{% endif %}

[api]
stores = main account-1 resource-1 package
threads = 10
base-port = 9080
mailer = queue
mailer-path = /var/lib/landscape/landscape-mail-queue
# XXX This is workaround to for the api service to not set it's root-url
#     to "/api", since "/api" is the path already present in the user
#     HTTP request. The fix would be to make that pre-path default to "".
root-url = http://localhost

[message-server]
base-port = 8090
threads = 8
stores = main account-1 resource-1 package

[pingserver]
base-port = 8070
stores = main account-1 resource-1
threads = 2

[async-frontend]
base-port = 9090

[job-handler]
stores = main account-1 resource-1 package
threads = 10
mailer = queue
mailer-path = /var/lib/landscape/landscape-mail-queue

[load-shaper]
critical-load = 10.0
good-load = 3.0
good-duration = 60.0

[scripts]
threads = 1
stores = main account-1 resource-1 package session knowledge
mailer = queue
mailer-path = /var/lib/landscape/landscape-mail-queue

[package-search]
{% if is_leader %}
host = localhost
{% else %}
host = {{ leader["leader-ip"] }}
{% endif %}
port = 9250                                                                    
stores = main package resource-1                                               
pid-path = /srv/landscape.canonical.com/var/landscape-package-search.pid       
account-threshold = 1000 
