NameVirtualHost *:80
<VirtualHost *:80>
   ServerName @hostname@
   ServerAdmin webmaster@@hostname@

   ErrorLog /var/log/apache2/landscape_error.log
   CustomLog /var/log/apache2/landscape_access.log combined
   DocumentRoot /opt/canonical/landscape/apacheroot/

   <Directory "/">
     Options +Indexes
     Order deny,allow
     Allow from all
     ErrorDocument 403 /static/offline/unauthorized.html
     ErrorDocument 404 /static/offline/notfound.html
   </Directory>

   Alias /static /opt/canonical/landscape/canonical/landscape/static
   Alias /repository /var/lib/landscape/landscape-repository
   Alias /config /opt/canonical/landscape/apacheroot
   Alias /hash-id-databases /var/lib/landscape/hash-id-databases

   <Location "/repository">
     Order deny,allow
     Deny from all
     ErrorDocument 403 default
     ErrorDocument 404 default
   </Location>

   <LocationMatch "/repository/[^/]+/[^/]+/(dists|pool)/.*">
     Allow from all
   </LocationMatch>

   <Location "/icons">
     Order allow,deny
     Allow from all
   </Location>

   <Location "/ajax">
     Order allow,deny
     Allow from all
   </Location>

   <Location />
     # Insert filter
     SetOutputFilter DEFLATE

     # Don't compress images or .debs
     SetEnvIfNoCase Request_URI \
     \.(?:gif|jpe?g|png|deb)$ no-gzip dont-vary

     # Make sure proxies don't deliver the wrong content
     Header append Vary User-Agent env=!dont-vary
   </Location>
</VirtualHost>
